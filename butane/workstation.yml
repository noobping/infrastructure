variant: fcos
version: 1.6.0

boot_device:
  luks:
    tpm2: true

systemd:
  units:
    - name: rebase-to-workstation.service
      enabled: true
      contents: |
        [Unit]
        Description=Rebase FCOS to boot container image
        Wants=network-online.target
        After=network-online.target
        ConditionPathExists=!/var/lib/rebase.done

        [Service]
        Type=oneshot
        ExecStart=/usr/bin/rpm-ostree rebase ostree-unverified-registry:ghcr.io/noobping/workstation:latest
        ExecStart=/usr/bin/touch /var/lib/rebase.done
        ExecStart=/usr/bin/systemctl --no-block reboot

        [Install]
        WantedBy=multi-user.target
